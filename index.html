<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
  <meta name="theme-color" content="#000000">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Belka Pay</title>
  
  <style>
    :root {
      --bg: #000000;
      --card-bg: linear-gradient(135deg, #1e1e1e, #2a2a2a);
      --accent: #34C759; /* Apple Green */
      --danger: #FF3B30;
      --text: #ffffff;
      --glass: rgba(255, 255, 255, 0.12);
      --glass-border: rgba(255, 255, 255, 0.08);
      --blur: 24px;
      --ease-elastic: cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif; user-select: none; }
    
    body {
      margin: 0; background: var(--bg); color: var(--text);
      height: 100vh; overflow: hidden;
      display: flex; flex-direction: column;
    }

    /* --- 3D CARD CONTAINER --- */
    .wallet-section {
      flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
      perspective: 1000px; z-index: 2;
    }

    .bank-card {
      width: 320px; height: 200px;
      background: linear-gradient(135deg, #4c1d95, #2563eb);
      border-radius: 24px;
      position: relative;
      transform-style: preserve-3d;
      box-shadow: 0 20px 50px rgba(37, 99, 235, 0.3);
      transition: transform 0.1s;
      padding: 24px;
      border: 1px solid rgba(255,255,255,0.1);
      overflow: hidden;
    }

    /* Glare effect for Gyroscope */
    .card-glare {
      position: absolute; inset: -100px;
      background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.4), transparent 60%);
      opacity: 0; mix-blend-mode: overlay; pointer-events: none;
      transform: translate(var(--glare-x), var(--glare-y));
    }

    .card-logo { font-size: 24px; font-weight: 800; opacity: 0.9; display: flex; justify-content: space-between; align-items: flex-start; }
    .card-chip { width: 44px; height: 32px; background: rgba(255,255,255,0.2); border-radius: 6px; margin-top: 24px; border: 1px solid rgba(255,255,255,0.1); position: relative; }
    .card-chip::after { content:''; position: absolute; inset: 0; border: 1px solid rgba(0,0,0,0.2); border-radius: 6px; background: repeating-linear-gradient(90deg, transparent 0, transparent 10px, rgba(0,0,0,0.1) 10px, rgba(0,0,0,0.1) 11px); }
    .card-number { font-size: 20px; letter-spacing: 2px; margin-top: 24px; font-family: monospace; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    .card-holder { font-size: 12px; text-transform: uppercase; opacity: 0.7; margin-top: auto; }

    /* --- CONTROLS --- */
    .controls {
      padding: 0 24px 40px; z-index: 10;
      display: flex; flex-direction: column; gap: 16px;
      background: linear-gradient(to top, #000 20%, transparent);
    }

    .amount-display {
      text-align: center; margin-bottom: 20px;
    }
    .amount-display span { font-size: 16px; color: #888; }
    .amount-display h2 { margin: 0; font-size: 42px; font-weight: 700; letter-spacing: -1px; }

    .slider-container {
      width: 100%; height: 64px;
      background: var(--glass);
      border-radius: 32px;
      position: relative;
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(var(--blur));
      overflow: hidden;
    }

    .slider-text {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      font-weight: 600; color: rgba(255,255,255,0.5);
      font-size: 15px; letter-spacing: 0.5px;
      animation: shine 3s infinite linear;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.8), transparent);
      background-size: 200px 100%;
      -webkit-background-clip: text;
    }

    .slider-knob {
      width: 56px; height: 56px;
      background: #fff;
      border-radius: 50%;
      position: absolute;
      top: 3px; left: 4px;
      display: flex; align-items: center; justify-content: center;
      color: #000; font-size: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      transition: transform 0.1s;
      cursor: grab;
    }

    /* --- OVERLAYS --- */
    .overlay {
      position: fixed; inset: 0; background: #000;
      z-index: 100; transform: translateY(100%);
      transition: transform 0.4s var(--ease-elastic);
      display: flex; flex-direction: column;
    }
    .overlay.active { transform: translateY(0); }

    /* Camera View */
    #cameraOverlay video {
      width: 100%; height: 100%; object-fit: cover; opacity: 0.6;
    }
    .scan-frame {
      position: absolute; top: 50%; left: 50%;
      width: 250px; height: 250px;
      transform: translate(-50%, -50%);
      border: 2px solid rgba(255,255,255,0.8);
      border-radius: 20px;
      box-shadow: 0 0 0 4000px rgba(0,0,0,0.7);
    }
    .scan-line {
      width: 100%; height: 2px; background: var(--accent);
      position: absolute; top: 0;
      animation: scan 2s infinite ease-in-out;
      box-shadow: 0 0 15px var(--accent);
    }

    /* Biometric View */
    .bio-content {
      flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center;
      background: rgba(20,20,20,0.9); backdrop-filter: blur(20px);
    }
    .face-id-icon {
      width: 60px; height: 60px; border: 3px solid var(--accent);
      border-radius: 18px; margin-bottom: 20px;
      position: relative;
      animation: breathe 2s infinite;
    }
    .face-id-icon::before {
        content: ''; position: absolute; top: 10px; left: 15px; right: 15px; bottom: 35px;
        border: 2px solid var(--accent); border-radius: 4px;
    }
    .face-id-icon::after {
        content: ''; position: absolute; bottom: 12px; left: 20px; width: 14px; height: 14px;
        background: var(--accent); border-radius: 50%;
    }

    @keyframes scan { 0%, 100% { top: 0; opacity: 0; } 50% { top: 100%; opacity: 1; } }
    @keyframes breathe { 0%, 100% { box-shadow: 0 0 10px rgba(52,199,89,0.2); } 50% { box-shadow: 0 0 25px rgba(52,199,89,0.6); } }
    @keyframes shine { from { background-position: -200px 0; } to { background-position: 200px 0; } }
    
    .hidden { display: none !important; }
  </style>
</head>
<body>

  <!-- CARD VIEW -->
  <div class="wallet-section">
    <div class="bank-card" id="card3d">
      <div class="card-glare" id="glare"></div>
      <div class="card-logo">
        <span>Belka Pay</span>
        <span>‚ôæÔ∏è</span>
      </div>
      <div class="card-chip"></div>
      <div class="card-number">4242 ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 8899</div>
      <div class="card-holder">
        Alexey Developer<br>
        <span style="font-size:10px; opacity:0.6">VALID THRU 12/28</span>
      </div>
    </div>
  </div>

  <div class="controls">
    <div class="amount-display">
      <span>–ö –æ–ø–ª–∞—Ç–µ</span>
      <h2>125.00 BYN</h2>
    </div>

    <!-- Swipe to Pay Slider -->
    <div class="slider-container" id="slider">
      <div class="slider-text">–°–í–ê–ô–ü –î–õ–Ø –û–ü–õ–ê–¢–´ &nbsp; ‚û§</div>
      <div class="slider-knob" id="knob">üêøÔ∏è</div>
    </div>
    
    <div style="text-align:center; opacity:0.4; font-size:11px; margin-top:10px;">
        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è AudioContext, Gyroscope & Camera API
    </div>
  </div>

  <!-- CAMERA OVERLAY -->
  <div class="overlay" id="cameraOverlay">
    <video id="videoFeed" autoplay playsinline muted></video>
    <div class="scan-frame">
      <div class="scan-line"></div>
    </div>
    <div style="position: absolute; bottom: 50px; width: 100%; text-align: center;">
      <h3>–ü–æ–∏—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞...</h3>
      <p style="opacity: 0.7">–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥</p>
      <button onclick="app.cancelPay()" style="background:rgba(255,255,255,0.2); border:none; color:#fff; padding:10px 20px; border-radius:20px; margin-top:10px;">–û—Ç–º–µ–Ω–∞</button>
    </div>
  </div>

  <!-- BIOMETRIC OVERLAY -->
  <div class="overlay" id="bioOverlay">
    <div class="bio-content">
      <div class="face-id-icon"></div>
      <h3>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</h3>
      <p style="opacity: 0.6">Belka Pay Secure</p>
    </div>
  </div>

  <script>
    class UltimateApp {
      constructor() {
        this.card = document.getElementById('card3d');
        this.glare = document.getElementById('glare');
        this.knob = document.getElementById('knob');
        this.slider = document.getElementById('slider');
        
        this.isDragging = false;
        this.startX = 0;
        this.sliderWidth = 0;
        
        this.init();
      }

      init() {
        // 1. Gyroscope Effect
        if (window.DeviceOrientationEvent && typeof window.DeviceOrientationEvent.requestPermission === 'function') {
           // iOS 13+ requires permission
           document.body.addEventListener('click', this.requestGyro.bind(this), { once: true });
        } else {
           window.addEventListener('deviceorientation', this.handleOrientation.bind(this));
        }

        // 2. Drag Logic
        this.knob.addEventListener('touchstart', this.startDrag.bind(this));
        this.knob.addEventListener('touchmove', this.onDrag.bind(this));
        this.knob.addEventListener('touchend', this.endDrag.bind(this));
        
        // Mouse fallback
        this.knob.addEventListener('mousedown', this.startDrag.bind(this));
        document.addEventListener('mousemove', this.onDrag.bind(this));
        document.addEventListener('mouseup', this.endDrag.bind(this));
      }

      // --- 3D CARD LOGIC ---
      async requestGyro() {
         try {
             await DeviceOrientationEvent.requestPermission();
             window.addEventListener('deviceorientation', this.handleOrientation.bind(this));
         } catch (e) { console.log('Gyro denied'); }
      }

      handleOrientation(e) {
        if (!e.gamma) return; // Desktop usually null
        const x = Math.min(Math.max(e.gamma, -40), 40); // Tilt left/right
        const y = Math.min(Math.max(e.beta - 45, -40), 40); // Tilt up/down (assuming phone held at 45deg)
        
        this.card.style.transform = `rotateY(${x / 2}deg) rotateX(${-y / 2}deg)`;
        
        // Glare movement
        const gx = 50 + (x * 2);
        const gy = 50 + (y * 2);
        this.glare.style.setProperty('--glare-x', `${gx}%`);
        this.glare.style.setProperty('--glare-y', `${gy}%`);
        this.glare.style.opacity = 0.5 + (Math.abs(x)/80);
      }

      // --- SLIDER LOGIC ---
      startDrag(e) {
        this.isDragging = true;
        this.startX = (e.touches ? e.touches[0].clientX : e.clientX);
        this.sliderWidth = this.slider.offsetWidth - 60; // 60 is knob width + padding
        this.knob.style.transition = 'none';
      }

      onDrag(e) {
        if (!this.isDragging) return;
        const cx = (e.touches ? e.touches[0].clientX : e.clientX);
        let x = cx - this.startX;
        
        if (x < 0) x = 0;
        if (x > this.sliderWidth) x = this.sliderWidth;
        
        this.knob.style.transform = `translateX(${x}px)`;
        
        // Haptic feedback as you slide
        if (x % 10 < 2 && navigator.vibrate) navigator.vibrate(5);

        if (x >= this.sliderWidth) {
          this.isDragging = false;
          this.triggerPaymentFlow();
        }
      }

      endDrag() {
        if (!this.isDragging) return;
        this.isDragging = false;
        // Snap back
        this.knob.style.transition = 'transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
        this.knob.style.transform = 'translateX(0px)';
      }

      // --- PAYMENT FLOW ---
      async triggerPaymentFlow() {
        if (navigator.vibrate) navigator.vibrate(50);
        
        // Try NFC first
        if ('NDEFReader' in window) {
           // NFC logic here (omitted for brevity, handled in previous iteration)
        }

        // Fallback to Camera/Simulated Scan
        this.startCamera();
      }

      async startCamera() {
        const overlay = document.getElementById('cameraOverlay');
        overlay.classList.add('active');
        
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            document.getElementById('videoFeed').srcObject = stream;
            
            // Simulate finding a QR code after 2.5 seconds
            setTimeout(() => {
                this.stopCamera(stream);
                this.showBiometrics();
            }, 2500);
            
        } catch (err) {
            console.error("Camera denied", err);
            // Fallback immediately to biometrics if camera fails
            overlay.classList.remove('active');
            this.showBiometrics();
        }
      }

      stopCamera(stream) {
          stream.getTracks().forEach(track => track.stop());
          document.getElementById('cameraOverlay').classList.remove('active');
      }
      
      cancelPay() {
          document.getElementById('cameraOverlay').classList.remove('active');
          window.location.reload(); // Quick reset
      }

      showBiometrics() {
          const bio = document.getElementById('bioOverlay');
          bio.classList.add('active');
          
          if (navigator.vibrate) navigator.vibrate([20, 50, 20]); // "Pay Attention" haptic

          // Simulate processing
          setTimeout(() => {
              this.success();
          }, 1500);
      }

      // --- AUDIO SYNTHESIS & SUCCESS ---
      success() {
        // 1. Play Sound (Generative Audio)
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        if (AudioContext) {
            const ctx = new AudioContext();
            const t = ctx.currentTime;
            
            // Pleasant Chord (C major 7)
            this.playTone(ctx, 523.25, t, "sine"); // C5
            this.playTone(ctx, 659.25, t + 0.1, "sine"); // E5
            this.playTone(ctx, 783.99, t + 0.2, "sine"); // G5
            this.playTone(ctx, 987.77, t + 0.3, "sine"); // B5
        }

        // 2. Visual Success
        document.querySelector('.face-id-icon').style.borderColor = '#34C759';
        document.querySelector('.face-id-icon').style.animation = 'none';
        document.querySelector('.face-id-icon').innerHTML = '<div style="font-size:40px; display:flex; justify-content:center; align-items:center; height:100%;">‚úÖ</div>';
        
        if (navigator.vibrate) navigator.vibrate([50, 100, 50]); // Success Haptic

        // 3. Close
        setTimeout(() => {
            document.getElementById('bioOverlay').classList.remove('active');
            this.knob.style.transform = 'translateX(0px)';
            this.knob.innerHTML = '‚úÖ';
            setTimeout(() => { this.knob.innerHTML = 'üêøÔ∏è'; }, 2000);
        }, 1200);
      }

      playTone(ctx, freq, time, type) {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.type = type;
          osc.frequency.setValueAtTime(freq, time);
          gain.gain.setValueAtTime(0.1, time);
          gain.gain.exponentialRampToValueAtTime(0.001, time + 0.8);
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.start(time);
          osc.stop(time + 0.8);
      }
    }

    const app = new UltimateApp();
  </script>
</body>
</html>
