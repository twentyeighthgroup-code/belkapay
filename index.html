<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <!-- –î–æ–±–∞–≤–ª—è–µ–º viewport-fit=cover –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ "—á–µ–ª–æ–∫" –Ω–∞ iPhone -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
  <meta name="theme-color" content="#009688">
  <meta name="description" content="Belka Pay - –ë–µ—Å–∫–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –æ–ø–ª–∞—Ç–∞">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Belka Pay</title>
  
  <style>
    :root {
      --primary: #FF5722;
      --secondary: #009688;
      --bg-gradient: linear-gradient(135deg, var(--secondary), var(--primary));
      --glass-bg: rgba(255, 255, 255, 0.75);
      --glass-border: rgba(255, 255, 255, 0.6);
      --text-main: #1f2937;
      --text-muted: #6b7280;
      --shadow-soft: 0 10px 30px rgba(0,0,0,0.15);
      --success: #10B981;
      --error: #EF4444;
      
      /* Safe Area Variables */
      --sat: env(safe-area-inset-top);
      --sab: env(safe-area-inset-bottom);
    }

    /* Reset & Base */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0; 
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh; 
      display: flex; 
      flex-direction: column;
      align-items: center; 
      color: var(--text-main);
      overscroll-behavior-y: none; /* –ë–ª–æ–∫–∏—Ä—É–µ—Ç "—Ä–µ–∑–∏–Ω–∫—É" —Å–∫—Ä–æ–ª–ª–∞ */
      padding-top: max(20px, var(--sat));
      padding-bottom: max(20px, var(--sab));
    }

    /* Layout */
    .container {
      width: 100%;
      max-width: 480px;
      padding: 0 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      position: relative;
      z-index: 1;
    }

    /* Header */
    header {
      text-align: center; 
      color: #fff; 
      padding: 20px 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    header h1 { margin: 0; font-size: 28px; font-weight: 800; letter-spacing: -0.5px; }
    header p { margin: 6px 0 0; opacity: 0.9; font-size: 14px; font-weight: 500; }

    /* Card Component */
    .card {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-radius: 24px;
      box-shadow: var(--shadow-soft);
      padding: 24px;
      border: 1px solid var(--glass-border);
      transition: transform 0.2s;
    }
    
    h2 { margin: 0 0 16px; color: var(--secondary); font-size: 18px; font-weight: 700; }

    /* Inputs */
    .input-group { margin-bottom: 16px; }
    label { display: block; font-size: 13px; color: var(--text-muted); margin-bottom: 8px; font-weight: 600; }
    
    select, input {
      width: 100%; 
      padding: 16px; 
      border-radius: 16px; 
      font-size: 16px; 
      border: 2px solid transparent; 
      outline: none;
      background: rgba(255,255,255,0.8);
      color: var(--text-main);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
      transition: all 0.2s;
      font-weight: 500;
    }
    
    select:focus, input:focus {
      background: #fff;
      border-color: var(--secondary);
      box-shadow: 0 0 0 4px rgba(0, 150, 136, 0.1);
    }

    .row { display: flex; gap: 12px; }
    .col { flex: 1; }

    /* Action Button */
    .btn-pay {
      width: 100%;
      padding: 18px;
      margin-top: 8px;
      border-radius: 16px;
      border: none;
      background: linear-gradient(135deg, var(--secondary), var(--primary));
      color: #fff;
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: transform 0.1s, filter 0.2s;
      position: relative;
      overflow: hidden;
    }
    .btn-pay:active { transform: scale(0.98); }
    .btn-pay:disabled { filter: grayscale(1); opacity: 0.7; cursor: not-allowed; }

    /* Animations */
    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.4);
      transform: scale(0);
      animation: ripple 0.6s linear;
      pointer-events: none;
    }
    @keyframes ripple { to { transform: scale(4); opacity: 0; } }

    .nfc-icon { font-size: 20px; }
    .nfc-pulse { animation: pulse 1.5s infinite; }
    @keyframes pulse { 0% { transform: scale(1); opacity: 0.7; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(1); opacity: 0.7; } }

    /* Feedback UI */
    .status-msg {
      margin-top: 16px;
      padding: 12px;
      border-radius: 12px;
      text-align: center;
      font-size: 14px;
      font-weight: 600;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s;
    }
    .status-msg.visible { opacity: 1; transform: translateY(0); }
    .status-msg.success { background: rgba(16, 185, 129, 0.15); color: #065F46; border: 1px solid rgba(16, 185, 129, 0.3); }
    .status-msg.error { background: rgba(239, 68, 68, 0.15); color: #7F1D1D; border: 1px solid rgba(239, 68, 68, 0.3); }

    /* History List */
    .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .btn-clear { background: none; border: none; color: var(--text-muted); font-size: 12px; cursor: pointer; text-decoration: underline; }
    
    .transaction-list { max-height: 300px; overflow-y: auto; }
    .transaction-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      animation: slideIn 0.3s ease;
    }
    .transaction-item:last-child { border-bottom: none; }
    
    .tx-info h4 { margin: 0; font-size: 15px; color: var(--text-main); }
    .tx-info span { font-size: 12px; color: var(--text-muted); display: block; margin-top: 2px; }
    .tx-amount { font-weight: 700; color: var(--text-main); font-size: 15px; }
    
    .empty-state { text-align: center; padding: 20px; color: var(--text-muted); font-size: 14px; font-style: italic; }

    @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    /* Footer */
    footer { text-align: center; margin-top: auto; padding: 20px; color: rgba(255,255,255,0.8); font-size: 12px; }

    /* Splash Screen */
    #splash {
      position: fixed; inset: 0; z-index: 9999;
      background: var(--bg-gradient);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      transition: opacity 0.5s ease, visibility 0.5s;
    }
    #splash.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
    .splash-logo { font-size: 64px; animation: bounce 2s infinite; margin-bottom: 16px; }
    .loader {
      width: 24px; height: 24px;
      border: 3px solid rgba(255,255,255,0.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }

    /* Dark Mode */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-gradient: linear-gradient(135deg, #0F172A, #1E293B);
        --glass-bg: rgba(30, 41, 59, 0.85);
        --glass-border: rgba(255, 255, 255, 0.1);
        --text-main: #F1F5F9;
        --text-muted: #94A3B8;
      }
      select, input { background: rgba(15, 23, 42, 0.6); border-color: #334155; }
      select:focus, input:focus { background: rgba(15, 23, 42, 0.9); }
      .status-msg.success { background: rgba(6, 95, 70, 0.3); color: #34D399; }
    }
  </style>
</head>
<body>

  <!-- Splash Screen -->
  <div id="splash">
    <div class="splash-logo">üêøÔ∏è</div>
    <div class="loader"></div>
  </div>

  <div class="container" id="app" style="opacity: 0; transition: opacity 0.5s;">
    <header>
      <h1>Belka Pay</h1>
      <p>–û–ø–ª–∞—Ç–∞ –≤ –æ–¥–Ω–æ –∫–∞—Å–∞–Ω–∏–µ</p>
    </header>

    <main>
      <!-- Payment Form -->
      <div class="card">
        <h2>–ù–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂</h2>
        
        <div class="input-group">
          <label for="cardSelect">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É</label>
          <select id="cardSelect">
            <option value="Visa Classic ‚Ä¢‚Ä¢ 4242">Visa Classic ‚Ä¢‚Ä¢ 4242</option>
            <option value="Mastercard World ‚Ä¢‚Ä¢ 8899">Mastercard World ‚Ä¢‚Ä¢ 8899</option>
            <option value="Mir Supreme ‚Ä¢‚Ä¢ 2200">Mir Supreme ‚Ä¢‚Ä¢ 2200</option>
          </select>
        </div>

        <div class="row">
          <div class="col input-group">
            <label for="amount">–°—É–º–º–∞ (BYN)</label>
            <!-- inputmode="decimal" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ü–∏—Ñ—Ä–æ–≤—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö -->
            <input id="amount" type="text" inputmode="decimal" placeholder="0.00" value="15.50" />
          </div>
          <div class="col input-group">
            <label for="merchant">–ü–æ–ª—É—á–∞—Ç–µ–ª—å</label>
            <input id="merchant" type="text" placeholder="–ú–∞–≥–∞–∑–∏–Ω..." value="Coffee Shop" />
          </div>
        </div>

        <button class="btn-pay" id="payBtn">
          <span class="nfc-icon">üì°</span> 
          <span id="btnText">–ü—Ä–∏–ª–æ–∂–∏—Ç—å –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É</span>
        </button>
        
        <div id="statusMsg" class="status-msg"></div>
        
        <div style="text-align: center; margin-top: 10px;">
            <small style="font-size: 11px; color: var(--text-muted);">
                –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Web NFC API (–≥–¥–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
            </small>
        </div>
      </div>

      <!-- History -->
      <div class="card" style="margin-top: 16px;">
        <div class="history-header">
          <h2>–ò—Å—Ç–æ—Ä–∏—è</h2>
          <button id="clearHistory" class="btn-clear">–û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        <div id="historyList" class="transaction-list">
          <!-- JS injected items -->
        </div>
      </div>
    </main>

    <footer>
      Belka Pay Secure ‚Ä¢ v2.0.1
    </footer>
  </div>

  <script>
    /**
     * Payment App Logic (OOP approach)
     */
    class PaymentApp {
      constructor() {
        // UI Elements
        this.els = {
          splash: document.getElementById('splash'),
          app: document.getElementById('app'),
          payBtn: document.getElementById('payBtn'),
          btnText: document.getElementById('btnText'),
          amount: document.getElementById('amount'),
          merchant: document.getElementById('merchant'),
          card: document.getElementById('cardSelect'),
          status: document.getElementById('statusMsg'),
          historyList: document.getElementById('historyList'),
          clearBtn: document.getElementById('clearHistory'),
          nfcIcon: document.querySelector('.nfc-icon')
        };

        this.history = JSON.parse(localStorage.getItem('belka_tx_history')) || [];
        this.isProcessing = false;

        this.init();
      }

      init() {
        this.renderHistory();
        this.setupListeners();
        
        // Remove Splash
        window.addEventListener('load', () => {
          setTimeout(() => {
            this.els.splash.classList.add('hidden');
            this.els.app.style.opacity = '1';
          }, 1200);
        });
      }

      setupListeners() {
        this.els.payBtn.addEventListener('click', (e) => {
          this.createRipple(e);
          this.handlePayment();
        });
        
        this.els.clearBtn.addEventListener('click', () => {
            if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é?')) {
                this.history = [];
                this.saveHistory();
                this.renderHistory();
            }
        });

        // Format currency input on blur
        this.els.amount.addEventListener('blur', (e) => {
            const val = parseFloat(e.target.value.replace(',', '.'));
            if (!isNaN(val)) e.target.value = val.toFixed(2);
        });
      }

      // Visual Ripple Effect on Button
      createRipple(event) {
        const button = event.currentTarget;
        const circle = document.createElement("span");
        const diameter = Math.max(button.clientWidth, button.clientHeight);
        const radius = diameter / 2;
        circle.style.width = circle.style.height = `${diameter}px`;
        circle.style.left = `${event.clientX - button.getBoundingClientRect().left - radius}px`;
        circle.style.top = `${event.clientY - button.getBoundingClientRect().top - radius}px`;
        circle.classList.add("ripple");
        const ripple = button.getElementsByClassName("ripple")[0];
        if (ripple) ripple.remove();
        button.appendChild(circle);
      }

      async handlePayment() {
        if (this.isProcessing) return;

        const amountVal = this.els.amount.value.replace(',', '.');
        const amount = parseFloat(amountVal);
        const merchant = this.els.merchant.value.trim();

        // Validation
        if (!amount || amount <= 0 || isNaN(amount)) {
          this.showStatus('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É', 'error');
          this.vibrate([100, 50, 100]); // Error vibration pattern
          return;
        }
        if (merchant.length < 2) {
          this.showStatus('–£–∫–∞–∂–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è', 'error');
          return;
        }

        this.setLoading(true);

        try {
            // Attempt Real NFC (Chrome on Android)
            if ('NDEFReader' in window) {
                try {
                    const ndef = new NDEFReader();
                    await ndef.scan();
                    // If we get here, permission granted. Wait for tag or simulate payment delay
                    console.log("NFC Scan started");
                } catch (nfcError) {
                    console.log("NFC not available or denied, falling back to timer");
                }
            }

            // Simulate Network/Processing Delay
            await new Promise(r => setTimeout(r, 2000));
            
            // Success
            this.addTransaction(merchant, amount, this.els.card.value);
            this.showStatus(`–£—Å–ø–µ—à–Ω–æ! –û–ø–ª–∞—Ç–∞ ${amount.toFixed(2)} BYN`, 'success');
            this.vibrate([50, 50, 50]); // Success haptic feedback
            
        } catch (error) {
            this.showStatus('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞', 'error');
            console.error(error);
        } finally {
            this.setLoading(false);
        }
      }

      setLoading(state) {
        this.isProcessing = state;
        this.els.payBtn.disabled = state;
        if (state) {
            this.els.btnText.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
            this.els.nfcIcon.classList.add('nfc-pulse');
            this.els.status.className = 'status-msg'; // hide previous
        } else {
            this.els.btnText.textContent = '–ü—Ä–∏–ª–æ–∂–∏—Ç—å –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É';
            this.els.nfcIcon.classList.remove('nfc-pulse');
        }
      }

      addTransaction(merchant, amount, card) {
        const tx = {
          id: Date.now(),
          merchant: merchant,
          amount: amount,
          card: card,
          date: new Date().toISOString()
        };
        this.history.unshift(tx);
        this.saveHistory();
        this.renderHistory();
      }

      renderHistory() {
        this.els.historyList.innerHTML = '';
        
        if (this.history.length === 0) {
            this.els.historyList.innerHTML = '<div class="empty-state">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞ üçÉ</div>';
            return;
        }

        const formatter = new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'BYN' });
        
        this.history.forEach(tx => {
            const date = new Date(tx.date);
            const timeStr = date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            
            // XSS Protection: Sanitize input before render
            const safeMerchant = this.escapeHtml(tx.merchant);
            const safeCard = this.escapeHtml(tx.card.split('‚Ä¢')[0]); // Just take brand name

            const item = document.createElement('div');
            item.className = 'transaction-item';
            item.innerHTML = `
                <div class="tx-info">
                    <h4>${safeMerchant}</h4>
                    <span>${timeStr} ‚Ä¢ ${safeCard}</span>
                </div>
                <div class="tx-amount">-${formatter.format(tx.amount)}</div>
            `;
            this.els.historyList.appendChild(item);
        });
      }

      saveHistory() {
        localStorage.setItem('belka_tx_history', JSON.stringify(this.history));
      }

      showStatus(msg, type) {
        this.els.status.textContent = msg;
        this.els.status.className = `status-msg visible ${type}`;
        
        // Auto hide after 3 sec
        setTimeout(() => {
            this.els.status.classList.remove('visible');
        }, 3000);
      }

      vibrate(pattern) {
        if (navigator.vibrate) navigator.vibrate(pattern);
      }
      
      // Security: Basic HTML escaping
      escapeHtml(unsafe) {
        return unsafe
             .replace(/&/g, "&amp;")
             .replace(/</g, "&lt;")
             .replace(/>/g, "&gt;")
             .replace(/"/g, "&quot;")
             .replace(/'/g, "&#039;");
     }
    }

    // Initialize App
    const app = new PaymentApp();
  </script>
</body>
</html>
