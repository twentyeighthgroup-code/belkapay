<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
  <meta name="theme-color" content="#000000">
  <meta name="description" content="Belka Pay - Next Gen Wallet">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Belka Pay</title>
  
  <style>
    /* --- CORE VARIABLES & RESET --- */
    :root {
      --bg: #050505;
      --card-1: linear-gradient(135deg, #FF512F, #DD2476);
      --card-2: linear-gradient(135deg, #434343, #000000); 
      --card-3: linear-gradient(135deg, #00F260, #0575E6);
      --glass: rgba(255, 255, 255, 0.1);
      --neon: #00ff88;
      --text: #ffffff;
      --font: -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
    }
    
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
    
    body {
      margin: 0; background: var(--bg); color: var(--text); font-family: var(--font);
      height: 100vh; overflow: hidden; display: flex; flex-direction: column;
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }

    /* --- TOP BAR --- */
    header {
      padding: 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10;
    }
    .profile-icon {
      width: 40px; height: 40px; background: #333; border-radius: 50%; 
      display: flex; align-items: center; justify-content: center; font-size: 20px;
      border: 1px solid rgba(255,255,255,0.2);
    }
    .logo { font-weight: 800; font-size: 20px; letter-spacing: -0.5px; }

    /* --- CARDS CAROUSEL (SWIPE) --- */
    .wallet-container {
      flex: 1; display: flex; flex-direction: column; justify-content: center;
      position: relative; perspective: 1000px;
    }

    .cards-scroll {
      display: flex; overflow-x: auto; scroll-snap-type: x mandatory;
      padding: 0 20vw; gap: 20px; scrollbar-width: none;
      height: 240px; align-items: center;
    }
    .cards-scroll::-webkit-scrollbar { display: none; }

    .bank-card {
      flex: 0 0 300px; height: 190px;
      border-radius: 20px; position: relative;
      scroll-snap-align: center;
      transition: transform 0.3s ease, opacity 0.3s;
      transform-style: preserve-3d;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,255,255,0.15);
    }
    /* Active card scales up logic handled in JS or CSS scroll driven anims */
    
    .c-visa { background: var(--card-1); }
    .c-black { background: var(--card-2); }
    .c-crypto { background: var(--card-3); }

    .card-top { display: flex; justify-content: space-between; margin-bottom: 30px; }
    .chip { width: 40px; height: 28px; background: rgba(255,255,255,0.2); border-radius: 6px; position: relative; }
    .chip::before { content:''; position:absolute; border:1px solid rgba(0,0,0,0.2); top:0; left:50%; height:100%; }
    .nfc-symbol { font-size: 24px; opacity: 0.8; }
    
    .card-num { font-size: 22px; letter-spacing: 3px; font-family: monospace; text-shadow: 0 2px 5px rgba(0,0,0,0.3); }
    .card-bottom { display: flex; justify-content: space-between; margin-top: auto; align-items: flex-end; height: 50px; }
    .token-timer { font-size: 10px; opacity: 0.7; display: flex; align-items: center; gap: 5px; }
    .token-bar { width: 30px; height: 4px; background: rgba(255,255,255,0.3); border-radius: 2px; overflow: hidden; }
    .token-fill { height: 100%; background: #fff; width: 100%; animation: token 30s linear infinite; }

    @keyframes token { from { width: 100%; } to { width: 0%; } }

    /* --- ACTIONS --- */
    .actions {
      padding: 30px 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
    }
    
    .action-btn {
      background: rgba(30,30,30,0.6); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.05);
      padding: 20px; border-radius: 18px;
      color: #fff; font-size: 16px; font-weight: 600;
      display: flex; flex-direction: column; align-items: center; gap: 10px;
      transition: 0.2s;
    }
    .action-btn:active { transform: scale(0.96); background: rgba(50,50,50,0.8); }
    .icon { font-size: 24px; }

    /* --- NFC MODE OVERLAY (The "Swoo" Mode) --- */
    .nfc-overlay {
      position: fixed; inset: 0; background: #000; z-index: 100;
      display: flex; flex-direction: column; align-items: center;
      transform: translateY(100%); transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
    }
    .nfc-overlay.active { transform: translateY(0); }

    .nfc-visual {
      flex: 1; display: flex; align-items: center; justify-content: center; position: relative; width: 100%;
    }
    
    /* NFC Ripples */
    .ripple {
      position: absolute; width: 200px; height: 200px; border-radius: 50%;
      border: 2px solid var(--neon); opacity: 0;
      animation: ripple 2s infinite;
    }
    .ripple:nth-child(2) { animation-delay: 0.5s; }
    .ripple:nth-child(3) { animation-delay: 1s; }

    @keyframes ripple {
      0% { transform: scale(0.5); opacity: 0; border-width: 4px; }
      50% { opacity: 1; border-width: 1px; }
      100% { transform: scale(2); opacity: 0; border-width: 0; }
    }

    .phone-icon {
      font-size: 80px; z-index: 2; animation: float 3s ease-in-out infinite;
    }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

    .nfc-status { padding: 40px; text-align: center; width: 100%; background: linear-gradient(to top, #000, transparent); }
    .nfc-status h2 { margin: 0; font-size: 24px; color: var(--neon); }
    .nfc-status p { color: #888; margin-top: 10px; font-size: 14px; }

    .close-btn {
      position: absolute; top: 40px; right: 20px;
      background: rgba(255,255,255,0.1); border: none; color: #fff;
      width: 40px; height: 40px; border-radius: 50%; font-size: 20px;
      z-index: 101; cursor: pointer;
    }

    /* --- TOAST NOTIFICATIONS --- */
    .toast {
      position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
      background: rgba(20, 20, 20, 0.95); border: 1px solid #333;
      padding: 12px 24px; border-radius: 30px; display: flex; align-items: center; gap: 10px;
      transition: 0.4s; z-index: 200; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    .toast.show { transform: translateX(-50%) translateY(0); }
  </style>
</head>
<body>

  <header>
    <div class="profile-icon">üêøÔ∏è</div>
    <div class="logo">Belka Pay</div>
    <div class="profile-icon" style="background:transparent; border:none;">üîî</div>
  </header>

  <div class="wallet-container">
    <div class="cards-scroll" id="cardSlider">
      
      <!-- Card 1: Default -->
      <div class="bank-card c-visa">
        <div class="card-top">
          <div class="chip"></div>
          <div class="nfc-symbol">(((</div>
        </div>
        <div class="card-num">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</div>
        <div class="card-bottom">
          <div>
            <div style="font-size:10px; opacity:0.7">–ë–ê–õ–ê–ù–°</div>
            <div style="font-weight:700">1,250.00 BYN</div>
          </div>
          <div class="token-timer">
            CVC
            <div class="token-bar"><div class="token-fill"></div></div>
          </div>
        </div>
      </div>

      <!-- Card 2: Black -->
      <div class="bank-card c-black">
        <div class="card-top">
          <div class="chip"></div>
          <div class="nfc-symbol">(((</div>
        </div>
        <div class="card-num">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 8899</div>
        <div class="card-bottom">
          <div>
            <div style="font-size:10px; opacity:0.7">–ë–ê–õ–ê–ù–°</div>
            <div style="font-weight:700">5,430.50 BYN</div>
          </div>
          <div style="font-weight:800; font-style: italic;">PLATINUM</div>
        </div>
      </div>

      <!-- Card 3: Crypto -->
      <div class="bank-card c-crypto">
        <div class="card-top">
          <div class="chip"></div>
          <div class="nfc-symbol">(((</div>
        </div>
        <div class="card-num">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 9001</div>
        <div class="card-bottom">
          <div>
            <div style="font-size:10px; opacity:0.7">USDT</div>
            <div style="font-weight:700">2,400.00 $</div>
          </div>
          <div style="font-size:20px">‚Çø</div>
        </div>
      </div>

    </div>
  </div>

  <div style="text-align: center; opacity: 0.5; font-size: 12px; margin-bottom: 10px;">
    –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É –¥–ª—è –æ–ø–ª–∞—Ç—ã
  </div>

  <div class="actions">
    <div class="action-btn" id="btnNfc">
      <div class="icon">üì°</div>
      <div>NFC –û–ø–ª–∞—Ç–∞</div>
    </div>
    <div class="action-btn" id="btnQr">
      <div class="icon">üì∑</div>
      <div>–°–∫–∞–Ω QR</div>
    </div>
  </div>

  <!-- NFC MODE UI -->
  <div class="nfc-overlay" id="nfcOverlay">
    <button class="close-btn" onclick="app.toggleNfc(false)">‚úï</button>
    <div class="nfc-visual">
      <div class="ripple"></div>
      <div class="ripple"></div>
      <div class="ripple"></div>
      <div class="phone-icon">üì±</div>
    </div>
    <div class="nfc-status">
      <h2 id="nfcStatusText">–ü–æ–¥–Ω–µ—Å–∏—Ç–µ –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É</h2>
      <p>–ò–¥–µ—Ç –ø–µ—Ä–µ–¥–∞—á–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞...</p>
    </div>
  </div>

  <div class="toast" id="toast">
    <span id="toastIcon">‚úÖ</span>
    <span id="toastMsg">–£—Å–ø–µ—à–Ω–æ</span>
  </div>

  <script>
    class WalletApp {
      constructor() {
        this.nfcOverlay = document.getElementById('nfcOverlay');
        this.statusText = document.getElementById('nfcStatusText');
        this.cards = document.querySelectorAll('.bank-card');
        this.slider = document.getElementById('cardSlider');
        
        this.ndef = null; // NFC Reader Object
        this.abortController = null;

        this.init();
      }

      init() {
        // Center the initial card
        this.slider.scrollLeft = 0;

        // Gyro Effect for cards (3D)
        if (window.DeviceOrientationEvent) {
          window.addEventListener('deviceorientation', (e) => this.handleGyro(e));
        }

        // Button Listeners
        document.getElementById('btnNfc').addEventListener('click', () => this.startNFC());
        document.getElementById('btnQr').addEventListener('click', () => this.showToast('QR —Å–∫–∞–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...', 'üì∑'));
      }

      handleGyro(e) {
        // Parallax effect applied to all cards
        const x = Math.min(Math.max(e.gamma || 0, -20), 20);
        const y = Math.min(Math.max(e.beta - 45, -20), 20); // assume 45deg holding angle

        this.cards.forEach(card => {
          card.style.transform = `perspective(1000px) rotateY(${x/1.5}deg) rotateX(${-y/1.5}deg)`;
        });
      }

      // --- NFC CORE LOGIC ---
      async startNFC() {
        this.toggleNfc(true);
        this.statusText.textContent = "–ü–æ–¥–Ω–µ—Å–∏—Ç–µ –∫ —Ç–µ—Ä–º–∏–Ω–∞–ª—É";
        this.vibrate([30]);

        // Check Hardware Support
        if (!('NDEFReader' in window)) {
          console.warn("Web NFC not supported on this device/browser");
          // Fallback Simulation for iPhone/Desktop
          this.simulateNfcFlow();
          return;
        }

        try {
          // Initialize Web NFC
          this.abortController = new AbortController();
          this.ndef = new NDEFReader();

          // Write Mode (Sending Token)
          // Note: In a real P2P scenario, we try to WRITE a record to the other device
          // Or we listen for the terminal to ping us.
          await this.ndef.write({
            records: [{ recordType: "text", data: "BELKA-TOKEN-" + Date.now() }]
          }, { signal: this.abortController.signal });

          // If write succeeds (terminal picked it up)
          this.onPaymentSuccess();

        } catch (error) {
          console.log("NFC Error or Cancelled:", error);
          if (error.name === 'NotAllowedError') {
            this.statusText.textContent = "‚ö†Ô∏è –ù—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∫ NFC";
          } else {
            // If actual write fails (no tag found), we keep scanning (Reader mode fallback)
            // or just rely on simulation if user holds it long enough
            this.simulateNfcFlow(); 
          }
        }
      }

      simulateNfcFlow() {
        // Emulates the timing of a real transaction if hardware API is missing/silent
        setTimeout(() => {
          this.statusText.textContent = "–û–±–º–µ–Ω –¥–∞–Ω–Ω—ã–º–∏...";
          this.vibrate([10]);
        }, 2000);

        setTimeout(() => {
          this.onPaymentSuccess();
        }, 4000);
      }

      onPaymentSuccess() {
        this.vibrate([50, 100, 50]); // Success pattern
        this.playSound();
        this.statusText.style.color = "#00ff88";
        this.statusText.textContent = "–û–ø–ª–∞—Ç–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ! 15.00 BYN";
        
        document.querySelector('.phone-icon').textContent = "‚úÖ";
        document.querySelector('.phone-icon').style.animation = "none";
        
        setTimeout(() => {
          this.toggleNfc(false);
          this.showToast("–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞", "üí∏");
          // Reset UI
          setTimeout(() => {
             document.querySelector('.phone-icon').textContent = "üì±";
             document.querySelector('.phone-icon').style.animation = "float 3s ease-in-out infinite";
             this.statusText.style.color = "var(--neon)";
          }, 500);
        }, 2500);
      }

      toggleNfc(show) {
        if (show) {
          this.nfcOverlay.classList.add('active');
        } else {
          this.nfcOverlay.classList.remove('active');
          if (this.abortController) {
            this.abortController.abort();
            this.abortController = null;
          }
        }
      }

      // --- UTILS ---
      showToast(msg, icon) {
        const t = document.getElementById('toast');
        document.getElementById('toastMsg').textContent = msg;
        document.getElementById('toastIcon').textContent = icon;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
      }

      vibrate(pattern) {
        if (navigator.vibrate) navigator.vibrate(pattern);
      }

      playSound() {
        // Cyberpunk style success sound
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        if (!AudioContext) return;
        
        const ctx = new AudioContext();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(440, ctx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(880, ctx.currentTime + 0.1);
        
        gain.gain.setValueAtTime(0.1, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
        
        osc.connect(gain);
        gain.connect(ctx.destination);
        osc.start();
        osc.stop(ctx.currentTime + 0.5);
      }
    }

    const app = new WalletApp();
  </script>
</body>
</html>
